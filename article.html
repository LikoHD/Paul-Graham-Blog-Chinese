<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« è¯¦æƒ… - Paul Graham æ–‡ç« é›†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background: #ffffff;
            margin: 0;
            padding: 16px;
            font-size: 16px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 24px;
        }
        
        .back-btn {
            color: #586069;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 16px;
            display: inline-block;
        }
        
        .back-btn:hover {
            color: #24292e;
            text-decoration: underline;
        }
        
        .back-btn::before {
            content: 'â† ';
        }
        
        .header-actions {
            margin-bottom: 24px;
        }
        
        .original-link {
            color: #0366d6;
            text-decoration: none;
            font-size: 14px;
        }
        
        .original-link:hover {
            text-decoration: underline;
        }
        
        .original-link::before {
            content: 'ğŸ”— ';
        }
        
        .article-title {
            font-size: 36px;
            font-weight: 600;
            margin-bottom: 4px;
            line-height: 0.4;
            color: #24292e;
        }
        
        .article-meta {
            color: #586069;
            font-size: 16px;
            margin-bottom: 32px;
        }
        
        .chinese-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 4px;
            line-height: 0.6;
            color: #24292e;
        }
        
        .loading, .error {
            text-align: center;
            padding: 60px 0;
            color: #586069;
        }
        
        .toggle-container {
            margin-bottom: 32px;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 16px;
        }
        
        .toggle-btn {
            display: inline-block;
            margin-right: 24px;
            cursor: pointer;
            color: #586069;
            text-decoration: none;
            font-size: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid transparent;
        }
        
        .toggle-btn.active {
            color: #24292e;
            border-bottom-color: #0366d6;
            font-weight: 600;
        }
        
        .toggle-btn:hover {
            color: #24292e;
        }
        
        .content-section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 24px;
            color: #24292e;
            margin-bottom: 24px;
            font-weight: 600;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 8px;
        }
        
        .parallel-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        
        .paragraph-pair {
            margin-bottom: 32px;
        }
        
        .language-label {
            font-size: 12px;
            font-weight: 600;
            color: #586069;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .original-text, .translated-text {
            line-height: 1.7;
            font-size: 16px;
            margin-bottom: 16px;
        }
        
        .original-text {
            color: #24292e;
        }
        
        .translated-text {
            color: #24292e;
            font-style: pingFang SC;
        }
        
        .hidden {
            display: none;
        }
        
        .paragraph-text {
            margin-bottom: 16px;
            line-height: 1.7;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 12px;
                font-size: 15px;
            }
            
            .article-title {
                font-size: 28px;
            }
            
            .toggle-btn {
                display: block;
                margin: 8px 0;
                font-size: 15px;
            }
            
            .parallel-view {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .original-text, .translated-text {
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-actions">
                <a href="index.html" class="back-btn">è¿”å›æ–‡ç« åˆ—è¡¨</a>
                <a href="#" class="original-link" id="originalLink">æŸ¥çœ‹åŸæ–‡</a>
            </div>
            <div class="article-meta" id="articleMeta"></div>            
            <h1 class="article-title" id="articleTitle"></h1>
        </div>
        
        <div class="loading" id="loading">
            æ­£åœ¨åŠ è½½æ–‡ç« å†…å®¹...
        </div>
        
        <div class="error hidden" id="error">
            <h3>åŠ è½½å¤±è´¥</h3>
            <p>æŠ±æ­‰ï¼Œæ–‡ç« å†…å®¹åŠ è½½å¤±è´¥ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚</p>
            <a href="index.html">è¿”å›é¦–é¡µ</a>
        </div>
        
        <div class="content hidden" id="content">
            <div class="toggle-container">
                <span class="toggle-btn active" id="parallelBtn" onclick="showView('parallel')">ä¸­è‹±å¯¹ç…§</span>
                <span class="toggle-btn" id="originalBtn" onclick="showView('original')">è‹±æ–‡åŸæ–‡</span>
                <span class="toggle-btn" id="translatedBtn" onclick="showView('translated')">ä¸­æ–‡ç¿»è¯‘</span>
            </div>
            
            <div id="articleContent">
                <!-- æ–‡ç« å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>
    
    <script>
        let currentView = 'parallel';
        let articleData = null;
        
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // æ˜¾ç¤ºä¸åŒè§†å›¾
        function showView(view) {
            currentView = view;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(view + 'Btn').classList.add('active');
            
            if (articleData) {
                renderArticleContent();
            }
        }
        
        // æ¸²æŸ“æ–‡ç« å†…å®¹
        function renderArticleContent() {
            const container = document.getElementById('articleContent');
            
            if (currentView === 'parallel') {
                renderParallelView(container);
            } else if (currentView === 'original') {
                renderSingleView(container, 'original');
            } else if (currentView === 'translated') {
                renderSingleView(container, 'translated');
            }
        }
        
        // æ¸²æŸ“å¯¹ç…§è§†å›¾
        function renderParallelView(container) {
            container.innerHTML = '';
            
            articleData.paragraphs.forEach((para, index) => {
                const pairDiv = document.createElement('div');
                pairDiv.className = 'paragraph-pair';
                
                // å¤„ç†æ–‡æœ¬å†…å®¹ï¼Œè¯†åˆ«æ ‡é¢˜å’Œæ®µè½
                const originalProcessed = processTextContent(para.original);
                const translatedProcessed = processTextContent(para.translated || 'ç¿»è¯‘ä¸­...');
                
                pairDiv.innerHTML = `
                    <div class="parallel-view">
                        <div>
                            <div class="language-label"></div>
                            <div class="original-text">${originalProcessed}</div>
                        </div>
                        <div>
                            <div class="language-label"></div>
                            <div class="translated-text">${translatedProcessed}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(pairDiv);
            });
        }
        
        // å¤„ç†æ–‡æœ¬å†…å®¹ï¼Œå¢åŠ æ ¼å¼åŒ–
        function processTextContent(text) {
            if (!text) return '';
            
            // è½¬ä¹‰HTML
            text = escapeHtml(text);
            
            // å¤„ç†æ®µè½åˆ†å‰²
            const paragraphs = text.split('\n\n').filter(p => p.trim());
            
            return paragraphs.map((paragraph, index) => {
                paragraph = paragraph.trim();
                
                // æ£€æµ‹æ˜¯å¦ä¸ºæ ‡é¢˜ï¼ˆçŸ­ä¸”åŒ…å«å…³é”®è¯ï¼‰
                if (paragraph.length < 100 && (
                    paragraph.match(/^[A-Z][^.!?]*$/) || // å…¨å¤§å†™å¼€å¤´æ— æ ‡ç‚¹
                    paragraph.match(/^\d+\./) || // æ•°å­—å¼€å¤´
                    paragraph.includes('Note:') ||
                    paragraph.includes('Summary:')
                )) {
                    return `<div class="article-heading">${paragraph}</div>`;
                }
                
                // æ£€æµ‹å¼•ç”¨ï¼ˆåŒ…å«å¼•å·çš„æ®µè½ï¼‰
                if (paragraph.includes('"') && paragraph.length < 300) {
                    return `<div class="quote-text">${paragraph}</div>`;
                }
                
                // æ™®é€šæ®µè½
                return `<div class="paragraph-text">${paragraph}</div>`;
            }).join('');
        }
        
        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
        
        // æ¸²æŸ“å•ä¸€è¯­è¨€è§†å›¾
        function renderSingleView(container, type) {
            container.innerHTML = '';
            
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'content-section';
            
            
            articleData.paragraphs.forEach((para, index) => {
                const text = type === 'original' ? para.original : (para.translated || 'ç¿»è¯‘ä¸­...');
                const className = type === 'original' ? 'original-text' : 'translated-text';
                const processedText = processTextContent(text);
                
                const paraDiv = document.createElement('div');
                paraDiv.innerHTML = `<div class="${className}">${processedText}</div>`;
                sectionDiv.appendChild(paraDiv);
            });
            
            container.appendChild(sectionDiv);
        }
        
        // æ¨¡æ‹Ÿç¿»è¯‘ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šè°ƒç”¨ç¿»è¯‘APIï¼‰
        function simulateTranslation(text) {
            // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„ç¿»è¯‘æœåŠ¡
            return `[ç¿»è¯‘] ${text}`;
        }
        
        // åŠ è½½æ–‡ç« å†…å®¹
        async function loadArticle() {
            const articleId = getUrlParameter('id');
            
            if (!articleId) {
                showError('æœªæŒ‡å®šæ–‡ç« ID');
                return;
            }
            
            try {
                // é¦–å…ˆåŠ è½½æ–‡ç« åˆ—è¡¨æ‰¾åˆ°å¯¹åº”æ–‡ç« 
                const articlesResponse = await fetch('data/articles.json');
                const articles = await articlesResponse.json();
                const article = articles.find(a => a.filename === articleId);
                
                if (!article) {
                    showError('æ–‡ç« ä¸å­˜åœ¨');
                    return;
                }
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œå…ƒä¿¡æ¯
                document.getElementById('articleTitle').textContent = article.title;
                document.title = `${article.title} - Paul Graham æ–‡ç« é›†`;
                
                // æ˜¾ç¤ºä¸­æ–‡æ ‡é¢˜
                const articleMeta = document.getElementById('articleMeta');
                if (article.title_zh) {
                    articleMeta.innerHTML = `<div class="chinese-title">${article.title_zh}</div>`;
                }
                
                // æ·»åŠ åŸæ–‡é“¾æ¥
                const originalLink = document.getElementById('originalLink');
                if (originalLink) {
                    originalLink.href = article.url;
                    originalLink.target = '_blank';
                    originalLink.rel = 'noopener noreferrer';
                }
                
                // å°è¯•åŠ è½½å·²å¤„ç†çš„æ–‡ç« æ•°æ®
                try {
                    const dataResponse = await fetch(`data/processed/${articleId.replace('.html', '.json')}`);
                    const processedData = await dataResponse.json();
                    
                    // è½¬æ¢æ•°æ®æ ¼å¼ä»¥é€‚é…å‰ç«¯
                    if (processedData.paragraphs && Array.isArray(processedData.paragraphs)) {
                        // æ£€æŸ¥æ˜¯å¦ä¸ºå·²ç¿»è¯‘æ ¼å¼ï¼ˆåŒ…å«originalå’Œtranslatedå­—æ®µï¼‰
                        if (processedData.paragraphs.length > 0 && 
                            typeof processedData.paragraphs[0] === 'object' && 
                            'original' in processedData.paragraphs[0]) {
                            // å·²ç¿»è¯‘æ ¼å¼
                            articleData = {
                                title: processedData.title,
                                url: processedData.url,
                                paragraphs: processedData.paragraphs
                            };
                        } else {
                            // æœªç¿»è¯‘æ ¼å¼ï¼Œè½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
                            articleData = {
                                title: processedData.title,
                                url: processedData.url,
                                paragraphs: processedData.paragraphs.map(para => ({
                                    original: para,
                                    translated: `[å¾…ç¿»è¯‘] ${para.substring(0, 50)}...`
                                }))
                            };
                        }
                    } else if (processedData.content && processedData.content.paragraphs && Array.isArray(processedData.content.paragraphs)) {
                        // æ–°æ ¼å¼ï¼šcontent.paragraphs æ˜¯å­—ç¬¦ä¸²æ•°ç»„
                        articleData = {
                            title: processedData.title,
                            url: processedData.url,
                            paragraphs: processedData.content.paragraphs.map(para => ({
                                original: para,
                                translated: `[å¾…ç¿»è¯‘] ${para.substring(0, 50)}...`
                            }))
                        };
                    } else {
                        throw new Error('æ•°æ®æ ¼å¼ä¸åŒ¹é…');
                    }
                } catch (e) {
                    console.log('ä½¿ç”¨æ—§æ•°æ®æ ¼å¼æˆ–åˆ›å»ºå ä½ç¬¦:', e.message);
                    // å¦‚æœæ²¡æœ‰å¤„ç†è¿‡çš„æ•°æ®ï¼Œåˆ›å»ºåŸºç¡€ç»“æ„
                    articleData = {
                        title: article.title,
                        url: article.url,
                        paragraphs: [
                            {
                                original: 'æ–‡ç« å†…å®¹æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ååˆ·æ–°é¡µé¢æŸ¥çœ‹å®Œæ•´å†…å®¹ã€‚',
                                translated: 'æ–‡ç« å†…å®¹æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ååˆ·æ–°é¡µé¢æŸ¥çœ‹å®Œæ•´å†…å®¹ã€‚'
                            }
                        ]
                    };
                }
                
                showContent();
                renderArticleContent();
                
            } catch (error) {
                console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
                showError('åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        function showContent() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
        }
        
        function showError(message) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('content').classList.add('hidden');
            document.querySelector('#error p').textContent = message;
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadArticle();
        });
    </script>
</body>
</html>